tests/
ios/ or android/
directories captured above]

# Implementation Plan: Show Current Location or Default

**Branch**: `001-show-current-location` | **Date**: 2025-12-28 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/001-show-current-location/spec.md`

**Note**: This plan is generated by `/speckit.plan`.

## Summary

Display the user's current location on map open, or default to Ho Chi Minh City if permission is denied. If GPS is unavailable but permission is granted, show last known location. The map always shows a marker (blue for user/last known, red for default) and a banner notification at bottom indicating location type ("Your location", "Last known location", or "Default location: Ho Chi Minh City"). This is a core usability feature for any map-based app and must work seamlessly for all users.

## Technical Context

**Language/Version**: Dart 3.5.4+, Flutter 3.5.4+  
**Primary Dependencies**: flutter_map (or alternatives: google_maps_flutter, mapbox_gl), geolocator (for location permission and device location), permission_handler (if needed for fine-grained permission control)  
**Storage**: N/A (no persistent storage required for this feature)  
**Testing**: flutter_test, widget/integration tests for permission and map behavior  
**Target Platform**: iOS 13+, Android 6.0+  
**Project Type**: mobile  
**Performance Goals**: Show location or default within 2 seconds of map open  
**Constraints**: Must handle permission changes and device location unavailability gracefully; must not crash or hang; must work offline (show default if no location)  
**Scale/Scope**: Single map screen, no background location, no persistent storage

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Initial Check (Pre-Phase 0)

Verify alignment with constitution principles:

- **MVP-First Development**: Yes, delivers working end-to-end location display in first iteration
- **Minimal Viable Features**: Yes, only shows user or default location, no extra features
- **Independent User Stories**: Yes, single story, independently testable
- **Progressive Enhancement**: Yes, uses standard Flutter plugins and platform capabilities
- **Maintainability**: Yes, no unnecessary complexity or dependencies

**Complexity Justification**: N/A (no advanced patterns or extra dependencies required)

### Post-Phase 1 Re-check

After completing Phase 1 design (research.md, data-model.md, contracts/, quickstart.md):

- **MVP-First Development**: ✅ PASS - Design delivers complete location display with all three scenarios (current, last known, default)
- **Minimal Viable Features**: ✅ PASS - Scope remains minimal: just location display and markers, no tracking or history
- **Independent User Stories**: ✅ PASS - Single P1 story, fully implementable without dependencies
- **Progressive Enhancement**: ✅ PASS - Uses geolocator and flutter_map (standard Flutter plugins), no custom complexity
- **Maintainability**: ✅ PASS - Simple data model (3 location types), clear validation rules, no advanced patterns

**Final Status**: ✅ ALL GATES PASSED - Ready to proceed to Phase 2 (tasks) or implementation

## Project Structure

### Documentation (this feature)

```text
specs/001-show-current-location/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command)
├── data-model.md        # Phase 1 output (/speckit.plan command)
├── quickstart.md        # Phase 1 output (/speckit.plan command)
├── contracts/           # Phase 1 output (/speckit.plan command)
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
lib/
└── features/
    └── show_current_location/
        ├── show_current_location_screen.dart
        ├── location_service.dart
        └── ...
```

**Structure Decision**: Feature code will be placed in `lib/features/show_current_location/` for modularity and maintainability. No changes to project-wide structure required.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| [e.g., 4th project] | [current need] | [why 3 projects insufficient] |
| [e.g., Repository pattern] | [specific problem] | [why direct DB access insufficient] |
